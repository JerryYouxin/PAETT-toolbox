# Prerequests

Before building PAETT tools, install several dependance listed below:

- C/C++ Compilers: gcc/g++
- x86_adapt
- x86_energy
- PAPI

# Build

PAETT libraries and tool applications can be built by make tools as follows.

~~~
$ cd PAETT-tool
$ make
~~~

The compiled executable tools are in `bin` directory, and libraries are in `lib` directory. 

# Usage

Compile the code with PAETT's clang/flang. We provide some wrapper scripts in `scripts` directory, where `paett-inst-*` is wrapper for PAETT's profiling instrumentation, and `paett-opt-*` is wrapper for PAETT's energy efficiency optimization.

To configure the profiling events of PAETT profiling, create/modify `profile.event` file in your executing path, all available PAPI events and energy collection `ENERGY` event (which utilizes x86_energy to collect energy profile for each region) can be configured. The generated profile can then be used to generate frequency commands by `freqcomm_gen` or list profiled CCT and significant regions by `paett_read_profile`.

# PAETT Environment Variables

Used by profiling with `libpaett_inst`:
- `PAETT_OUTPUT_PATH`: the path to PAETT's profiling output file
- `PAETT_DETECT_MODE`: set to `ENABLE` to enable PAETT's detection mode of significant region, which only collects executing time of each CCT. The result file is generated as `PAETT_DETECT_RES_PATH` or default file name `libpaett_inst.log`. The generated file can then used as input of `filter_gen` tool to generate filter for PAETT's compiler plugin for lower profiling overhead.
- `PAETT_DETECT_RES_PATH`: the path to PAETT's generated file by PAETT's detection mode. If `PAETT_DETECT_MODE` is set to `ENABLE`, this configures the path of the output file.

Used by PAETT compiler instrumentation plugin (`paett-inst-*`):
- `PAETT_FILTER`: the path to filter file, which is generated by `filter_gen` tool. Each line in this filter file is PAETT's annotated debug information and only the regions listed in this filter file will be instrumented.
- `PAETT_CCT_FREQUENCY_COMMAND_FILTER`: the path to CCT-aware frequency command filter, which is generated by `freqcomm_gen` tool.

`-paett_frequency_command_file=<path/to/file>`: command line option to configure the path to PAETT's generated frequency command file.